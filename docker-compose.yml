version: '3.8'

services:
  # Default Grafana instance syncing with grafana/ directory
  grafana-default:
    image: grafana/grafana:latest
    container_name: grafana-default
    ports:
      - "3000:3000"
    environment:
      - GF_AUTH_ANONYMOUS_ENABLED=true
      - GF_AUTH_ANONYMOUS_ORG_ROLE=Admin
      - GF_SECURITY_ADMIN_PASSWORD=admin
      - GF_SECURITY_ADMIN_USER=admin
      - GF_INSTALL_PLUGINS=
    volumes:
      - grafana-default-data:/var/lib/grafana
      - ./grafana:/etc/grafana/provisioning/dashboards/default:ro
    networks:
      - grafana-net
    restart: unless-stopped

  # Dev environment Grafana instance
  grafana-dev:
    image: grafana/grafana:latest
    container_name: grafana-dev
    ports:
      - "3001:3000"
    environment:
      - GF_AUTH_ANONYMOUS_ENABLED=true
      - GF_AUTH_ANONYMOUS_ORG_ROLE=Admin
      - GF_SECURITY_ADMIN_PASSWORD=admin
      - GF_SECURITY_ADMIN_USER=admin
      - GF_SERVER_ROOT_URL=http://localhost:3001
    volumes:
      - grafana-dev-data:/var/lib/grafana
      - ./grafana-dev:/etc/grafana/provisioning/dashboards/dev:ro
    networks:
      - grafana-net
    restart: unless-stopped

  # Prod environment Grafana instance
  grafana-prod:
    image: grafana/grafana:latest
    container_name: grafana-prod
    ports:
      - "3002:3000"
    environment:
      - GF_AUTH_ANONYMOUS_ENABLED=true
      - GF_AUTH_ANONYMOUS_ORG_ROLE=Admin
      - GF_SECURITY_ADMIN_PASSWORD=admin
      - GF_SECURITY_ADMIN_USER=admin
      - GF_SERVER_ROOT_URL=http://localhost:3002
    volumes:
      - grafana-prod-data:/var/lib/grafana
      - ./grafana-prod:/etc/grafana/provisioning/dashboards/prod:ro
    networks:
      - grafana-net
    restart: unless-stopped

  # Mirror setup Grafana instance
  grafana-mirror:
    image: grafana/grafana:latest
    container_name: grafana-mirror
    ports:
      - "3003:3000"
    environment:
      - GF_AUTH_ANONYMOUS_ENABLED=true
      - GF_AUTH_ANONYMOUS_ORG_ROLE=Admin
      - GF_SECURITY_ADMIN_PASSWORD=admin
      - GF_SECURITY_ADMIN_USER=admin
      - GF_SERVER_ROOT_URL=http://localhost:3003
    volumes:
      - grafana-mirror-data:/var/lib/grafana
      - ./grafana-mirror:/etc/grafana/provisioning/dashboards/mirror:ro
    networks:
      - grafana-net
    restart: unless-stopped

volumes:
  grafana-default-data:
  grafana-dev-data:
  grafana-prod-data:
  grafana-mirror-data:

networks:
  grafana-net:
    driver: bridge
